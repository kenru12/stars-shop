<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Stars Shop Pro</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        * { -webkit-tap-highlight-color: transparent; box-sizing: border-box; outline: none; }
        body {
            margin: 0; background-color: #000; color: #fff;
            font-family: -apple-system, system-ui, sans-serif;
            overflow: hidden; height: 100vh; display: flex; flex-direction: column;
        }
        canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 0; }
        
        .container { position: relative; z-index: 1; padding: 20px; flex: 1; overflow-y: auto; padding-bottom: 100px; }

        /* PROFILE HEADER */
        .profile-header { 
            display: flex; align-items: center; gap: 15px; margin-bottom: 20px; 
            background: rgba(255,255,255,0.03); padding: 12px; border-radius: 18px; 
            border: 1px solid rgba(138, 43, 226, 0.2); backdrop-filter: blur(10px);
        }
        .avatar-container { width: 50px; height: 50px; border-radius: 50%; overflow: hidden; border: 2px solid #8a2be2; background: #1a1a1a; }
        .avatar-container img { width: 100%; height: 100%; object-fit: cover; }
        .user-info h2 { margin: 0; font-size: 16px; font-weight: 700; color: #fff; }
        .lvl-badge { color: #8a2be2; font-size: 10px; font-weight: 800; letter-spacing: 0.5px; }

        /* INPUTS */
        .input-group { margin-bottom: 15px; }
        .input-field {
            background: rgba(255,255,255,0.05); border: 1px solid rgba(255,255,255,0.1);
            border-radius: 15px; padding: 14px; width: 100%; color: #fff; font-size: 15px;
        }
        .input-field::placeholder { color: #555; }

        /* GRID */
        .grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 20px; }
        .card {
            background: rgba(255, 255, 255, 0.04); border: 1px solid rgba(255,255,255,0.08);
            border-radius: 16px; padding: 15px; text-align: center; transition: 0.2s;
        }
        .card.selected { border-color: #8a2be2; background: rgba(138, 43, 226, 0.1); }
        .card b { font-size: 20px; display: block; margin-bottom: 2px; }
        .card span { font-size: 13px; color: #8a2be2; font-weight: 600; white-space: nowrap; }

        /* TABS */
        .tabs-content { display: none; }
        .tabs-content.active { display: block; animation: fadeIn 0.3s ease; }

        /* NAV BAR */
        .nav-bar {
            position: fixed; bottom: 25px; left: 20px; right: 20px;
            background: rgba(15, 15, 15, 0.9); backdrop-filter: blur(20px);
            border-radius: 20px; display: flex; padding: 5px; border: 1px solid rgba(255,255,255,0.05);
        }
        .nav-item { flex: 1; padding: 12px; border: none; background: transparent; color: #555; font-weight: 700; border-radius: 16px; font-size: 14px; transition: 0.3s; }
        .nav-item.active { background: #8a2be2; color: #fff; }

        .btn-pay { width: 100%; padding: 18px; border-radius: 18px; border: none; background: #8a2be2; color: #fff; font-weight: 800; font-size: 16px; margin-top: 10px; box-shadow: 0 4px 15px rgba(138, 43, 226, 0.3); }

        /* REF BOX */
        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 15px; }
        .stat-card { background: rgba(255,255,255,0.03); padding: 15px; border-radius: 15px; text-align: center; border: 1px solid rgba(255,255,255,0.05); }
        .stat-card small { color: #555; font-size: 10px; text-transform: uppercase; display: block; margin-bottom: 5px; }
        .stat-card b { font-size: 18px; color: #8a2be2; }

        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <canvas id="snow-canvas"></canvas>
    
    <div class="container">
        <div id="shop-tab" class="tabs-content active">
            <div class="profile-header">
                <div class="avatar-container"><img id="u-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png"></div>
                <div class="user-info">
                    <h2 id="u-name">User</h2>
                    <span class="lvl-badge">LEVEL 1 • НОВИЧОК</span>
                </div>
            </div>

            <div class="input-group">
                <input type="text" id="target-user" class="input-field" placeholder="@username получателя">
            </div>

            <div class="grid">
                <div class="card" onclick="pick(100, 154, this)"><b>100 ⭐</b><span>154р</span></div>
                <div class="card" onclick="pick(250, 385, this)"><b>250 ⭐</b><span>385р</span></div>
                <div class="card" onclick="pick(500, 770, this)"><b>500 ⭐</b><span>770р</span></div>
                <div class="card" onclick="pick(1000, 1540, this)"><b>1000 ⭐</b><span>1540р</span></div>
            </div>

            <div class="input-group" style="position: relative;">
                <input type="number" id="calc-inp" class="input-field" placeholder="Другое количество..." oninput="recalc()">
                <span id="calc-res" style="position: absolute; right: 15px; top: 14px; color: #8a2be2; font-weight: 800;">0р</span>
            </div>
            
            <button class="btn-pay" onclick="sendOrder()">ОПЛАТИТЬ</button>
        </div>

        <div id="profile-tab" class="tabs-content">
            <div style="text-align: center; padding: 20px 0;">
                <div class="avatar-container" style="width: 80px; height: 80px; margin: 0 auto 10px; border-width: 3px;">
                    <img id="big-avatar" src="https://cdn-icons-png.flaticon.com/512/3135/3135715.png">
                </div>
                <h2 id="big-name" style="font-size: 20px;">User</h2>
            </div>

            <div style="background: rgba(138, 43, 226, 0.05); border: 1px dashed #8a2be2; padding: 15px; border-radius: 15px; text-align: center;">
                <span style="font-size: 13px; color: #ccc;">Ваша ссылка для приглашений:</span>
                <div id="ref-link" style="font-size: 11px; color: #8a2be2; margin: 10px 0; background: #000; padding: 8px; border-radius: 8px;">t.me/bot?start=0</div>
                <button onclick="copyRef()" style="background: #fff; color: #000; border: none; padding: 6px 15px; border-radius: 10px; font-weight: 700; font-size: 11px;">Копировать</button>
            </div>

            <div class="stats-grid">
                <div class="stat-card"><small>Рефералы</small><b id="ref-count">0</b></div>
                <div class="stat-card"><small>Бонусы</small><b id="ref-bonus">0р</b></div>
            </div>
        </div>
    </div>

    <div class="nav-bar">
        <button id="nav-shop" class="nav-item active" onclick="tab('shop')">Магазин</button>
        <button id="nav-prof" class="nav-item" onclick="tab('prof')">Профиль</button>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();

        const COURSE = 1.54;
        const user = tg.initDataUnsafe.user || { first_name: 'Пользователь', id: 0, username: '' };
        
        document.getElementById('u-name').innerText = user.first_name;
        document.getElementById('big-name').innerText = user.first_name;
        document.getElementById('target-user').value = user.username ? '@' + user.username : '';
        document.getElementById('ref-link').innerText = 'https://t.me/StarsShopBot?start=' + user.id;

        if(user.photo_url) {
            document.getElementById('u-avatar').src = user.photo_url;
            document.getElementById('big-avatar').src = user.photo_url;
        }

        let order = null;

        function tab(name) {
            document.querySelectorAll('.tabs-content').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));
            if(name === 'shop') {
                document.getElementById('shop-tab').classList.add('active');
                document.getElementById('nav-shop').classList.add('active');
            } else {
                document.getElementById('profile-tab').classList.add('active');
                document.getElementById('nav-prof').classList.add('active');
            }
        }

        function pick(v, p, el) {
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            el.classList.add('selected');
            order = { stars: v, rub: p };
            document.getElementById('calc-inp').value = '';
            document.getElementById('calc-res').innerText = '0р';
        }

        function recalc() {
            const val = document.getElementById('calc-inp').value;
            const res = Math.ceil(val * COURSE);
            document.getElementById('calc-res').innerText = res + 'р';
            document.querySelectorAll('.card').forEach(c => c.classList.remove('selected'));
            if(val > 0) order = { stars: val, rub: res };
        }

        function sendOrder() {
            const target = document.getElementById('target-user').value;
            if(!order) return tg.showAlert("Выберите количество звезд!");
            if(!target) return tg.showAlert("Введите @username получателя!");
            
            const data = { ...order, to: target };
            tg.sendData(JSON.stringify(data));
        }

        function copyRef() {
            navigator.clipboard.writeText(document.getElementById('ref-link').innerText);
            tg.showAlert("Ссылка скопирована!");
        }

        // Snow Animation
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let w, h, p = [];
        function init() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            p = Array.from({length: 40}, () => ({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*1.5+0.5, s: Math.random()*0.4+0.1 }));
        }
        function draw() {
            ctx.clearRect(0,0,w,h); ctx.fillStyle = "rgba(255,255,255,0.2)"; ctx.beginPath();
            p.forEach(i => { ctx.moveTo(i.x, i.y); ctx.arc(i.x, i.y, i.r, 0, Math.PI*2); i.y += i.s; if(i.y > h) i.y = -5; });
            ctx.fill(); requestAnimationFrame(draw);
        }
        init(); draw(); window.onresize = init;
    </script>
</body>

</html>
