<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Telegram Stars</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
        :root {
            --tg-bg: #0f1721;
            --tg-sec-bg: #1c2733;
            --tg-button: #2481cc;
            --tg-text: #ffffff;
            --tg-hint: #708499;
        }

        body {
            margin: 0; background-color: var(--tg-bg); color: var(--tg-text);
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            overflow: hidden; height: 100vh;
        }

        canvas { position: fixed; top: 0; left: 0; pointer-events: none; z-index: 0; }
        .app { position: relative; z-index: 1; height: 100vh; display: flex; flex-direction: column; }
        .content { flex: 1; overflow-y: auto; padding: 16px; padding-bottom: 120px; }

        /* HEADER IMAGE */
        .banner { width: 100%; border-radius: 12px; margin-bottom: 16px; }

        /* INPUT GROUP */
        .input-card { background: var(--tg-sec-bg); border-radius: 12px; padding: 4px 12px; margin-bottom: 12px; display: flex; align-items: center; min-height: 54px; transition: 0.3s; }
        
        .avatar-reveal { width: 0; height: 32px; border-radius: 50%; overflow: hidden; margin-right: 0; transition: 0.4s ease; opacity: 0; transform: scale(0.5); }
        .avatar-reveal.show { width: 32px; margin-right: 10px; opacity: 1; transform: scale(1); }
        .avatar-reveal img { width: 100%; height: 100%; object-fit: cover; }

        .input-card input { flex: 1; background: transparent; border: none; color: #fff; font-size: 16px; padding: 12px 0; outline: none; }
        .input-card input::placeholder { color: var(--tg-hint); }

        .btn-inner { background: var(--tg-button); color: #fff; border: none; border-radius: 20px; padding: 6px 16px; font-size: 13px; font-weight: 600; cursor: pointer; }

        /* QUICK SELECT */
        .stars-row { display: flex; gap: 8px; overflow-x: auto; padding-bottom: 16px; scrollbar-width: none; }
        .stars-row::-webkit-scrollbar { display: none; }
        .star-badge { background: var(--tg-sec-bg); border-radius: 20px; padding: 8px 14px; font-size: 14px; white-space: nowrap; border: 1px solid transparent; transition: 0.2s; }
        .star-badge.active { border-color: var(--tg-button); background: rgba(36, 129, 204, 0.1); }
        .star-badge span { color: #f9d43d; margin-right: 4px; }

        /* PAYMENT BOXES */
        .pay-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 10px; }
        .pay-item { background: var(--tg-sec-bg); border-radius: 12px; padding: 16px; text-align: center; border: 1px solid transparent; }
        .pay-item.active { border-color: var(--tg-button); }
        .pay-item img { height: 24px; margin-bottom: 8px; display: block; margin-left: auto; margin-right: auto; }
        .pay-label { font-size: 12px; color: var(--tg-hint); }

        /* BOTTOM NAV */
        .nav { position: fixed; bottom: 0; left: 0; right: 0; background: var(--tg-sec-bg); display: flex; padding: 8px 0; border-top: 1px solid rgba(255,255,255,0.05); }
        .nav-item { flex: 1; text-align: center; color: var(--tg-hint); font-size: 10px; font-weight: 500; border: none; background: none; }
        .nav-item.active { color: var(--tg-button); }
        .nav-icon { font-size: 22px; display: block; margin-bottom: 4px; }

        .btn-main { background: var(--tg-button); color: #fff; width: 100%; border: none; border-radius: 12px; padding: 16px; font-size: 16px; font-weight: 700; margin-top: 20px; }

        .tab { display: none; }
        .tab.active { display: block; animation: fadeIn 0.3s; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <canvas id="stars-bg"></canvas>
    <div class="app">
        <div class="content">
            <div id="shop" class="tab active">
                <img src="https://i.imgur.com/8QxYy3R.png" class="banner" alt="Promo">

                <div class="input-card">
                    <div id="ava-reveal" class="avatar-reveal">
                        <img id="u-ava-img" src="">
                    </div>
                    <span>@</span>
                    <input type="text" id="target" placeholder="–í–≤–µ–¥–∏—Ç–µ username" oninput="checkUser()">
                    <button class="btn-inner" onclick="setSelf()">–°–µ–±–µ</button>
                </div>

                <div class="input-card">
                    <span style="margin-right: 10px;">‚≠ê</span>
                    <input type="number" id="count" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–æ–ª–∏—á–µ—Å—Ç–≤–æ –∑–≤—ë–∑–¥" oninput="recalc()">
                </div>

                <div class="stars-row">
                    <div class="star-badge" onclick="setV(100, 154, this)"><span>‚≠ê</span> 100</div>
                    <div class="star-badge" onclick="setV(250, 385, this)"><span>‚≠ê</span> 250</div>
                    <div class="star-badge" onclick="setV(500, 770, this)"><span>‚≠ê</span> 500</div>
                    <div class="star-badge" onclick="setV(1000, 1540, this)"><span>‚≠ê</span> 1000</div>
                    <div class="star-badge" onclick="setV(5000, 7700, this)"><span>‚≠ê</span> 5000</div>
                </div>

                <div class="pay-grid">
                    <div class="pay-item active">
                        <img src="https://i.imgur.com/DOnx9mC.png" alt="SBP">
                        <div class="pay-label">–°–ë–ü</div>
                    </div>
                    <div class="pay-item">
                        <img src="https://i.imgur.com/uPId1U1.png" alt="MIR">
                        <div class="pay-label">–ö–∞—Ä—Ç—ã (RUB)</div>
                    </div>
                </div>

                <button class="btn-main" id="pay-btn" onclick="buy()">–ö—É–ø–∏—Ç—å</button>
            </div>

            <div id="profile" class="tab">
                <div style="text-align:center; padding: 20px 0;">
                    <div style="width: 80px; height: 80px; border-radius: 50%; background: var(--tg-sec-bg); margin: 0 auto 12px; overflow: hidden; border: 2px solid var(--tg-button);">
                        <img id="p-ava" src="" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div id="p-name" style="font-size: 20px; font-weight: 700;">–ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å</div>
                </div>
                <div style="background: var(--tg-sec-bg); border-radius: 12px; padding: 16px; margin-top: 10px;">
                    <div style="color: var(--tg-button); font-weight: 700; margin-bottom: 8px;">–ó–∞—Ä–∞–±–∞—Ç—ã–≤–∞–π 50% –¥–æ—Ö–æ–¥–∞</div>
                    <div style="color: var(--tg-hint); font-size: 13px; margin-bottom: 16px;">–ü—Ä–∏–≥–ª–∞—à–∞–π –¥—Ä—É–∑–µ–π –∏ –ø–æ–ª—É—á–∞–π –ø—Ä–æ—Ü–µ–Ω—Ç –æ—Ç –∏—Ö –ø–æ–∫—É–ø–æ–∫.</div>
                    <div style="background: var(--tg-bg); border-radius: 8px; padding: 12px; font-size: 12px; color: var(--tg-button); word-break: break-all;" id="ref-link">...</div>
                </div>
            </div>
        </div>

        <div class="nav">
            <button class="nav-item active" onclick="switchTab('shop', this)">
                <span class="nav-icon">‚≠ê</span>–ú–∞–≥–∞–∑–∏–Ω
            </button>
            <button class="nav-item" onclick="switchTab('profile', this)">
                <span class="nav-icon">üë§</span>–ü—Ä–æ—Ñ–∏–ª—å
            </button>
        </div>
    </div>

    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.backgroundColor = '#0f1721';
        tg.headerColor = '#0f1721';

        const user = tg.initDataUnsafe.user || { first_name: 'User', username: 'user', photo_url: '' };
        const RATE = 1.54;

        // Init UI
        document.getElementById('p-name').innerText = user.first_name;
        document.getElementById('ref-link').innerText = 'https://t.me/StarsBot?start=' + user.id;
        if(user.photo_url) document.getElementById('p-ava').src = user.photo_url;

        function checkUser() {
            const input = document.getElementById('target').value;
            const ava = document.getElementById('ava-reveal');
            const img = document.getElementById('u-ava-img');
            
            if(input.length >= 3) {
                // –í —Ä–µ–∞–ª—å–Ω–æ—Å—Ç–∏ —Ç—É—Ç –±—É–¥–µ—Ç –∑–∞–ø—Ä–æ—Å –∫ –±–æ—Ç—É –∑–∞ –∞–≤–æ–π, –ø–æ–∫–∞ —Å–∏–º—É–ª—è—Ü–∏—è
                img.src = user.photo_url || 'https://cdn-icons-png.flaticon.com/512/3135/3135715.png';
                ava.classList.add('show');
            } else {
                ava.classList.remove('show');
            }
        }

        function setSelf() {
            document.getElementById('target').value = user.username || user.first_name;
            checkUser();
        }

        function setV(v, p, el) {
            document.querySelectorAll('.star-badge').forEach(b => b.classList.remove('active'));
            el.classList.add('active');
            document.getElementById('count').value = v;
            recalc();
        }

        function recalc() {
            const v = document.getElementById('count').value;
            const price = Math.ceil(v * RATE);
            const btn = document.getElementById('pay-btn');
            if(v > 0) {
                btn.innerText = `–ö—É–ø–∏—Ç—å –∑–∞ ${price} ‚ÇΩ`;
            } else {
                btn.innerText = '–ö—É–ø–∏—Ç—å';
            }
        }

        function switchTab(id, el) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            el.classList.add('active');
        }

        function buy() {
            const v = document.getElementById('count').value;
            const to = document.getElementById('target').value;
            if(!v || !to) return tg.showAlert("–ó–∞–ø–æ–ª–Ω–∏—Ç–µ –≤—Å–µ –ø–æ–ª—è!");
            tg.sendData(JSON.stringify({stars: v, to: to}));
        }

        // Falling Stars
        const canvas = document.getElementById('stars-bg');
        const ctx = canvas.getContext('2d');
        let w, h, dots = [];
        function init() {
            w = canvas.width = window.innerWidth;
            h = canvas.height = window.innerHeight;
            dots = Array.from({length: 40}, () => ({ x: Math.random()*w, y: Math.random()*h, r: Math.random()*1.5, s: Math.random()*0.5+0.1 }));
        }
        function draw() {
            ctx.clearRect(0,0,w,h); ctx.fillStyle = "rgba(255,255,255,0.2)";
            dots.forEach(d => {
                ctx.beginPath(); ctx.arc(d.x, d.y, d.r, 0, Math.PI*2); ctx.fill();
                d.y += d.s; if(d.y > h) d.y = -5;
            });
            requestAnimationFrame(draw);
        }
        init(); draw();
    </script>
</body>
</html>